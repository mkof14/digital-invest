# Modern Image Formats - Automation Guide

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ WebP –∏ AVIF —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (WebP –∏ AVIF) –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö JPG/PNG —Ñ–∞–π–ª–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è:
- **60-85% —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å JPEG/PNG
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é** –ø—Ä–∏ production —Å–±–æ—Ä–∫–µ
- **Fallback** –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
- **–ü—Ä–æ–∑—Ä–∞—á–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

–°–∏—Å—Ç–µ–º–∞ —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ `vite.config.ts` –∏ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ production —Å–±–æ—Ä–∫–µ:

```bash
npm run build
```

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–∫–∞–Ω–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
2. –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è WebP –∏ AVIF –≤–µ—Ä—Å–∏–∏
3. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ä—è–¥–æ–º —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
4. –í—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–∞–∑–º–µ—Ä–∞

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –±–µ–∑ –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–∏:

```bash
node scripts/generate-modern-formats.js
```

### –û—á–∏—Å—Ç–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö WebP –∏ AVIF —Ñ–∞–π–ª–æ–≤:

```bash
node scripts/clean-modern-formats.js
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `scripts/generate-modern-formats.js`

```javascript
const CONFIG = {
  quality: {
    webp: 85,  // –ö–∞—á–µ—Å—Ç–≤–æ WebP (0-100)
    avif: 80   // –ö–∞—á–µ—Å—Ç–≤–æ AVIF (0-100)
  },
  directories: [
    'src/assets',
    'src/assets/projects',
    'src/assets/team',
    'public/lovable-uploads'
  ],
  extensions: ['.jpg', '.jpeg', '.png'],
  skipIfExists: true,  // –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –µ—Å–ª–∏ —Ñ–∞–π–ª—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
  formats: ['webp', 'avif']  // –ö–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
};
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Vite –ø–ª–∞–≥–∏–Ω–∞

–í `vite.config.ts`:

```typescript
modernImagesPlugin({
  enabled: mode === 'production',  // –¢–æ–ª—å–∫–æ –¥–ª—è production
  runOnBuild: true,                // –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π
  watch: false                      // Watch mode –¥–ª—è dev
})
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `OptimizedImage` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å WebP/AVIF –≤–µ—Ä—Å–∏–∏:

```tsx
import OptimizedImage from '@/components/OptimizedImage';

<OptimizedImage
  src="/assets/image.jpg"
  alt="Description"
  webpSrc="/assets/image.webp"  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ
  avifSrc="/assets/image.avif"  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ
/>
```

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

```tsx
const getModernImageFormats = (src: string) => {
  const pathWithoutExt = src.replace(/\.[^/.]+$/, '');
  return {
    avif: `${pathWithoutExt}.avif`,
    webp: `${pathWithoutExt}.webp`,
    fallback: src
  };
};

const formats = getModernImageFormats('/assets/hero.jpg');
<OptimizedImage {...formats} alt="Hero" />
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
src/assets/projects/
‚îú‚îÄ‚îÄ biomathlife-hero.jpg      # –û—Ä–∏–≥–∏–Ω–∞–ª
‚îú‚îÄ‚îÄ biomathlife-hero.webp     # WebP –≤–µ—Ä—Å–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ biomathlife-hero.avif     # AVIF –≤–µ—Ä—Å–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ terraaero-hero.jpg
‚îú‚îÄ‚îÄ terraaero-hero.webp
‚îî‚îÄ‚îÄ terraaero-hero.avif
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏

### AVIF
- ‚úÖ Chrome 85+
- ‚úÖ Firefox 93+
- ‚úÖ Edge 85+
- ‚ùå Safari 16+ (—á–∞—Å—Ç–∏—á–Ω–∞—è)
- ‚ùå IE (–Ω–µ—Ç)

### WebP
- ‚úÖ Chrome 23+
- ‚úÖ Firefox 65+
- ‚úÖ Edge 18+
- ‚úÖ Safari 14+
- ‚ùå IE (–Ω–µ—Ç)

### Fallback
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ JPEG/PNG –¥–ª—è –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `<picture>` —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–∏–ø–∏—á–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Ä–∞–∑–º–µ—Ä–∞

| –§–æ—Ä–º–∞—Ç | –†–∞–∑–º–µ—Ä | –≠–∫–æ–Ω–æ–º–∏—è |
|--------|---------|----------|
| JPEG   | 500 KB  | Baseline |
| WebP   | 150 KB  | 70%      |
| AVIF   | 100 KB  | 80%      |

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏

- **LCP (Largest Contentful Paint)**: ‚Üì 40-60%
- **Time to Interactive**: ‚Üì 30-50%
- **Total Transfer Size**: ‚Üì 60-80%
- **Mobile Performance Score**: ‚Üë 15-25 points

## CI/CD Integration

### GitHub Actions –ø—Ä–∏–º–µ—Ä

```yaml
name: Build with Modern Images

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: npm install
      - run: npm run build  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã
      - run: npm run deploy
```

### Vercel

–§–æ—Ä–º–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ `npm run build`.

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Sharp –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

```bash
npm install sharp --save-dev
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏"

–£–≤–µ–ª–∏—á—å—Ç–µ Node.js heap size:

```bash
NODE_OPTIONS="--max-old-space-size=4096" node scripts/generate-modern-formats.js
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã:
   ```bash
   ls src/assets/projects/*.webp
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –≤ –∫–æ–¥–µ:
   ```tsx
   console.log(getModernImageFormats('/assets/image.jpg'));
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS headers –≤ `vercel.json`

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### DO ‚úÖ

- –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º production deploy
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ 80-85 –¥–ª—è WebP –∏ 75-80 –¥–ª—è AVIF
- –•—Ä–∞–Ω–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ git –¥–ª—è reproducibility
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `OptimizedImage` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–µ–∑–¥–µ

### DON'T ‚ùå

- –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤ development (–º–µ–¥–ª–µ–Ω–Ω–æ)
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (<70)
- –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ alt —Ç–µ–∫—Å—Ç –¥–ª—è accessibility
- –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (<10KB)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
üìä Conversion Summary:
‚úÖ Successfully processed: 20
üì¶ Total original size: 15.4 MB
üéØ Total WebP size: 4.2 MB (72.7% smaller)
üéØ Total AVIF size: 3.1 MB (79.9% smaller)
üíæ Estimated bandwidth savings: 11.2 MB per load cycle
```

### Production –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome DevTools ‚Üí Network tab –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- Content-Type –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `image/webp` –∏–ª–∏ `image/avif`
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] Responsive images —Å srcset
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è blur hashes
- [ ] Progressive JPEG fallback
- [ ] CDN integration
- [ ] Image optimization metrics dashboard
